{% macro render_big_table(data, classes="table table-striped") %}
<style>
.table {
  border-collapse: collapse;
  border: 1px solid #999;
  width: 100%;
  font-size: 15px;
  margin-top: 10px;
}
.table th, .table td {
  border: 1px solid #999;
  text-align: right;
  padding: 8px 12px;
}
.table th {
  font-weight: bold;
  text-align: left;
  background-color: #f7f7f7;
}
.table thead th {
  border-bottom: 2px solid #999;
}
.table-striped tbody tr:nth-child(odd) {
  background-color: #f9f9f9;
}
.table thead .group-header {
  text-align: center;
  background-color: #f2f2f2;
}
</style>

{% set header_groups = [] %}
{% set subheaders = [] %}

{# Build group and subheader lists from data.headers #}
{% for col in data.headers %}
  {% if col[0] is string %}
    {# Single-level header like "Month" #}
    {% do header_groups.append({"group": "", "count": 1}) %}
    {% do subheaders.append(col[0]) %}
  {% else %}
    {# Multi-level header, e.g. ["Fund", "Zero fee earnings"] #}
    {% for item in col %}
      {% do subheaders.append(item[1]) %}
    {% endfor %}
    {% for g in col|groupby(0) %}
      {% do header_groups.append({"group": g.grouper, "count": g.list|length}) %}
    {% endfor %}
  {% endif %}
{% endfor %}

<table class="{{ classes }}">
  <thead>
    <tr>
      {# Top-level group headers #}
      {% for group in header_groups %}
        {% if group.group == "" %}
          <th rowspan="2">{{ subheaders[loop.index0] }}</th>
        {% else %}
          <th colspan="{{ group.count }}" class="group-header">{{ group.group }}</th>
        {% endif %}
      {% endfor %}
    </tr>
    <tr>
      {# Subheaders row #}
      {% for label in subheaders %}
        {% if loop.index0 > 0 %}
          <th>{{ label }}</th>
        {% endif %}
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for row in data.rows %}
      <tr>
        {% for val in row %}
          <td>{{ val }}</td>
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endmacro %}
